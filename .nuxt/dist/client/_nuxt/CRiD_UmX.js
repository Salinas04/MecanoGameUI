import{_ as $}from"./Br3K3lNa.js";import{B as ee,k as re,r as a,g as E,l as te,c as o,a as r,p as ae,t as v,z as c,q as M,m,x,b as oe,w as le,o as l,d as se}from"./AkD5g4Ve.js";import{u as de}from"./6njsMXsu.js";const ue={class:"max-w-3xl mx-auto"},ne={key:0,class:"text-center py-8"},ie={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},ce={key:2,class:"grid grid-cols-1 md:grid-cols-3 gap-6"},ge={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-200 dark:border-gray-700 p-6 md:col-span-1"},pe={class:"flex flex-col items-center"},fe={class:"h-32 w-32 rounded-full overflow-hidden border-2 border-primary-500 mb-4 flex items-center justify-center bg-gray-200 dark:bg-gray-700"},be=["src"],ye={key:1,xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 448 512",class:"h-12 w-12 text-gray-500 dark:text-gray-400"},ve={class:"w-full"},me={key:0,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},xe={key:1,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},we={class:"mb-4"},he={class:"relative"},ke={class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500 flex items-center"},Pe={key:0,class:"truncate"},_e={key:1,class:"text-gray-500 dark:text-gray-400"},Ce=["disabled"],Ue={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-200 dark:border-gray-700 p-6 md:col-span-2"},Ee={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},Ve={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},Fe={class:"mb-4"},Ie={class:"mb-6"},Ne=["disabled"],Se={class:"bg-white dark:bg-gray-800 rounded-2xl shadow-md border border-gray-200 dark:border-gray-700 p-6 md:col-span-3"},Be={key:0,class:"bg-green-100 border border-green-400 text-green-700 px-4 py-3 rounded mb-4"},qe={key:1,class:"bg-red-100 border border-red-400 text-red-700 px-4 py-3 rounded mb-4"},Me={class:"mb-4"},je={class:"mb-4"},Te={class:"mb-6"},ze={key:0,class:"text-red-500 text-sm mt-1"},Ae=["disabled"],Le={class:"md:col-span-3 text-center mt-4 flex justify-center space-x-4"},Re={__name:"profile",setup(De){const j=ee(),{user:g,isAuthenticated:T,fetchUser:I,logout:z}=re(),{loading:A,error:w,getUserProfile:L,updateUserProfile:D,uploadProfilePicture:G,changePassword:Y,getProfilePictureUrl:N}=de(),h=a(null),k=a(null),p=a(null),P=a(null),f=a(""),b=a(""),s=a(""),y=a(""),d=a(""),i=a(""),n=a(null),V=a(null),_=a(!1),C=a(!1),U=a(!1),S=a(!1);function J(){S.value=!0}function R(t){const e=t.target.files;e.length>0?n.value=e[0]:n.value=null}const W=E(()=>{var t,e;return f.value!==((t=g.value)==null?void 0:t.username)||b.value!==((e=g.value)==null?void 0:e.email)}),B=E(()=>d.value&&i.value&&d.value!==i.value),H=E(()=>y.value&&d.value&&i.value&&d.value===i.value&&d.value.length>=6),q=E(()=>{var t,e;if(!s.value)return"/default-avatar.png";if(typeof s.value=="object"&&s.value.data&&typeof s.value.data=="string"&&s.value.data.startsWith("data:"))return s.value.data;if(typeof s.value=="object"&&s.value.fileId){const F={_id:(t=g.value)==null?void 0:t._id,profilePicture:{fileId:s.value.fileId}};return N(F)}return(e=g.value)!=null&&e._id?N(g.value._id):typeof s.value=="string"?s.value:"/default-avatar.png"});async function K(){h.value=null;try{const t=await L();t&&(f.value=t.username,b.value=t.email,s.value=t.profilePicture)}catch(t){console.error("Error loading user profile:",t),h.value=w.value||"Failed to load profile. Please try again."}}async function O(){_.value=!1,k.value=null;try{await D({username:f.value,email:b.value})&&(await I(),_.value=!0,setTimeout(()=>{_.value=!1},3e3))}catch(t){console.error("Error updating profile:",t),k.value=w.value||"Failed to update profile. Please try again."}}async function Q(){p.value=null,C.value=!1;try{if(!n.value){p.value="Please select an image file.";return}const t=await G(n.value);t&&(s.value=t.profilePicture,await I(),C.value=!0,n.value=null,V.value&&(V.value.value=""),setTimeout(()=>{C.value=!1},3e3))}catch(t){console.error("Error updating profile picture:",t),p.value=w.value||"Failed to update profile picture. Please try again."}}async function X(){if(!B.value){U.value=!1,P.value=null;try{await Y({currentPassword:y.value,newPassword:d.value})&&(y.value="",d.value="",i.value="",U.value=!0,setTimeout(()=>{U.value=!1},3e3))}catch(t){console.error("Error changing password:",t),P.value=w.value||"Failed to change password. Please check your current password and try again."}}}async function Z(){await z()}return te(()=>{T.value?K():j.push("/login")}),(t,e)=>{const F=$;return l(),o("div",ue,[e[19]||(e[19]=r("div",{class:"text-center mb-8"},[r("h1",{class:"text-3xl font-bold text-gray-800 dark:text-white mb-2"},"Your Profile"),r("p",{class:"text-gray-600 dark:text-gray-300"},"Manage your account settings")],-1)),ae(A)?(l(),o("div",ne,e[5]||(e[5]=[r("div",{class:"inline-block animate-spin rounded-full h-8 w-8 border-t-2 border-b-2 border-primary-600"},null,-1),r("p",{class:"mt-2 text-gray-600 dark:text-gray-400"},"Loading your profile...",-1)]))):h.value?(l(),o("div",ie,v(h.value),1)):(l(),o("div",ce,[r("div",ge,[e[10]||(e[10]=r("h2",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Profile Picture",-1)),r("div",pe,[r("div",fe,[q.value!=="/default-avatar.png"&&!S.value?(l(),o("img",{key:0,src:q.value,alt:"Profile",class:"h-full w-full object-cover",onError:J},null,40,be)):(l(),o("svg",ye,e[6]||(e[6]=[r("path",{fill:"currentColor",d:"M224 256A128 128 0 1 0 224 0a128 128 0 1 0 0 256zm-45.7 48C79.8 304 0 383.8 0 482.3C0 498.7 13.3 512 29.7 512l388.6 0c16.4 0 29.7-13.3 29.7-29.7C448 383.8 368.2 304 269.7 304l-91.4 0z"},null,-1)])))]),r("div",ve,[p.value?(l(),o("div",me,v(p.value),1)):c("",!0),C.value?(l(),o("div",xe," Profile picture updated successfully! ")):c("",!0),r("div",we,[e[8]||(e[8]=r("label",{for:"profilePictureFile",class:"block text-gray-700 dark:text-gray-300 mb-2"},"Upload Image",-1)),r("div",he,[r("input",{type:"file",id:"profilePictureFile",ref_key:"fileInput",ref:V,onChange:R,accept:"image/*",class:"absolute inset-0 w-full h-full opacity-0 cursor-pointer z-10"},null,544),r("div",ke,[n.value?(l(),o("span",Pe,v(n.value.name),1)):(l(),o("span",_e,"Choose a file...")),e[7]||(e[7]=r("button",{type:"button",class:"ml-auto bg-gray-200 dark:bg-gray-600 hover:bg-gray-300 dark:hover:bg-gray-500 text-gray-700 dark:text-gray-200 px-3 py-1 rounded-lg text-sm"}," Browse ",-1))])]),e[9]||(e[9]=r("p",{class:"text-sm text-gray-500 dark:text-gray-400 mt-1"},"Supported formats: JPG, PNG, GIF",-1))]),r("button",{onClick:Q,class:"w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-2 px-4 rounded-xl transition-colors",disabled:!n.value}," Update Picture ",8,Ce)])])]),r("div",Ue,[e[13]||(e[13]=r("h2",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Profile Information",-1)),r("form",{onSubmit:M(O,["prevent"])},[_.value?(l(),o("div",Ee," Profile updated successfully! ")):c("",!0),k.value?(l(),o("div",Ve,v(k.value),1)):c("",!0),r("div",Fe,[e[11]||(e[11]=r("label",{for:"username",class:"block text-gray-700 dark:text-gray-300 mb-2"},"Username",-1)),m(r("input",{"onUpdate:modelValue":e[0]||(e[0]=u=>f.value=u),type:"text",id:"username",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Your username",required:"",minlength:"3",maxlength:"30"},null,512),[[x,f.value]])]),r("div",Ie,[e[12]||(e[12]=r("label",{for:"email",class:"block text-gray-700 dark:text-gray-300 mb-2"},"Email",-1)),m(r("input",{"onUpdate:modelValue":e[1]||(e[1]=u=>b.value=u),type:"email",id:"email",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Your email",required:""},null,512),[[x,b.value]])]),r("button",{type:"submit",class:"w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-xl transition-colors mb-4",disabled:!W.value}," Save Changes ",8,Ne)],32)]),r("div",Se,[e[17]||(e[17]=r("h2",{class:"text-xl font-bold text-gray-800 dark:text-white mb-4"},"Change Password",-1)),r("form",{onSubmit:M(X,["prevent"])},[U.value?(l(),o("div",Be," Password changed successfully! ")):c("",!0),P.value?(l(),o("div",qe,v(P.value),1)):c("",!0),r("div",Me,[e[14]||(e[14]=r("label",{for:"currentPassword",class:"block text-gray-700 dark:text-gray-300 mb-2"},"Current Password",-1)),m(r("input",{"onUpdate:modelValue":e[2]||(e[2]=u=>y.value=u),type:"password",id:"currentPassword",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter your current password",required:""},null,512),[[x,y.value]])]),r("div",je,[e[15]||(e[15]=r("label",{for:"newPassword",class:"block text-gray-700 dark:text-gray-300 mb-2"},"New Password",-1)),m(r("input",{"onUpdate:modelValue":e[3]||(e[3]=u=>d.value=u),type:"password",id:"newPassword",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Enter your new password",required:"",minlength:"6"},null,512),[[x,d.value]])]),r("div",Te,[e[16]||(e[16]=r("label",{for:"confirmPassword",class:"block text-gray-700 dark:text-gray-300 mb-2"},"Confirm New Password",-1)),m(r("input",{"onUpdate:modelValue":e[4]||(e[4]=u=>i.value=u),type:"password",id:"confirmPassword",class:"w-full p-3 border border-gray-300 dark:border-gray-600 rounded-xl bg-white dark:bg-gray-700 text-gray-800 dark:text-white focus:outline-none focus:ring-2 focus:ring-primary-500",placeholder:"Confirm your new password",required:""},null,512),[[x,i.value]]),B.value?(l(),o("p",ze,"Passwords do not match")):c("",!0)]),r("button",{type:"submit",class:"w-full bg-primary-600 hover:bg-primary-700 text-white font-medium py-3 px-4 rounded-xl transition-colors",disabled:!H.value}," Change Password ",8,Ae)],32)]),r("div",Le,[oe(F,{to:"/dashboard",class:"inline-block bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white font-medium py-2 px-6 rounded-xl transition-colors"},{default:le(()=>e[18]||(e[18]=[se(" Back to Dashboard ")])),_:1,__:[18]}),r("button",{onClick:Z,class:"inline-block bg-red-600 hover:bg-red-700 text-white font-medium py-2 px-6 rounded-xl transition-colors"}," Logout ")])]))])}}};export{Re as default};
