{"version":3,"file":"friends-BeUNQ1JU.js","sources":["../../../../pages/friends.vue"],"sourcesContent":["<template>\r\n  <div class=\"container mx-auto px-4 py-8\">\r\n    <div class=\"flex flex-col md:flex-row gap-8\">\r\n      <!-- Left sidebar - Friends list and requests -->\r\n      <div class=\"w-full md:w-1/3 space-y-6\">\r\n        <!-- Friend Requests Section -->\r\n        <div class=\"bg-glass-light dark:bg-glass-dark backdrop-blur-md rounded-xl p-6 shadow-glass\">\r\n          <h2 class=\"text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center\">\r\n            <span>Friend Requests</span>\r\n            <span v-if=\"friendRequests.received.length > 0\" \r\n                  class=\"ml-2 bg-primary-600 text-white text-xs font-medium px-2.5 py-0.5 rounded-full\">\r\n              {{ friendRequests.received.length }}\r\n            </span>\r\n          </h2>\r\n          \r\n          <div v-if=\"friendRequests.received.length === 0 && friendRequests.sent.length === 0\" \r\n               class=\"text-gray-500 dark:text-gray-400 text-center py-4\">\r\n            No pending friend requests\r\n          </div>\r\n          \r\n          <!-- Received Requests -->\r\n          <div v-if=\"friendRequests.received.length > 0\" class=\"mb-4\">\r\n            <h3 class=\"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2\">Received</h3>\r\n            <ul class=\"space-y-3\">\r\n              <li v-for=\"request in friendRequests.received\" :key=\"request._id\" \r\n                  class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-white/50 dark:bg-gray-800/50 rounded-lg\">\r\n                <div class=\"flex items-center\">\r\n                  <img :src=\"getProfilePictureUrl(request.sender)\" alt=\"Profile\" \r\n                       class=\"w-10 h-10 rounded-full object-cover mr-3\">\r\n                  <span class=\"font-medium\">{{ request.sender.username }}</span>\r\n                </div>\r\n                <div class=\"flex space-x-2 mt-2 sm:mt-0 ml-auto\">\r\n                  <button @click=\"acceptFriendRequest(request._id)\" \r\n                          class=\"px-3 py-1 bg-primary-600 hover:bg-primary-700 text-white rounded-md text-sm transition-colors\">\r\n                    Accept\r\n                  </button>\r\n                  <button @click=\"rejectFriendRequest(request._id)\" \r\n                          class=\"px-3 py-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md text-sm transition-colors\">\r\n                    Reject\r\n                  </button>\r\n                </div>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n          \r\n          <!-- Sent Requests -->\r\n          <div v-if=\"friendRequests.sent.length > 0\">\r\n            <h3 class=\"text-sm font-medium text-gray-600 dark:text-gray-300 mb-2\">Sent</h3>\r\n            <ul class=\"space-y-3\">\r\n              <li v-for=\"request in friendRequests.sent\" :key=\"request._id\" \r\n                  class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-white/50 dark:bg-gray-800/50 rounded-lg\">\r\n                <div class=\"flex items-center\">\r\n                  <img :src=\"getProfilePictureUrl(request.receiver)\" alt=\"Profile\" \r\n                       class=\"w-10 h-10 rounded-full object-cover mr-3\">\r\n                  <span class=\"font-medium\">{{ request.receiver.username }}</span>\r\n                </div>\r\n                <span class=\"text-xs text-gray-500 dark:text-gray-400 mt-2 sm:mt-0\">Pending</span>\r\n              </li>\r\n            </ul>\r\n          </div>\r\n        </div>\r\n        \r\n        <!-- Friends List Section -->\r\n        <div class=\"bg-glass-light dark:bg-glass-dark backdrop-blur-md rounded-xl p-6 shadow-glass\">\r\n          <h2 class=\"text-xl font-bold text-gray-800 dark:text-white mb-4 flex items-center\">\r\n            <span>Friends</span>\r\n            <span v-if=\"friends.length > 0\" \r\n                  class=\"ml-2 bg-gray-200 dark:bg-gray-700 text-gray-800 dark:text-white text-xs font-medium px-2.5 py-0.5 rounded-full\">\r\n              {{ friends.length }}\r\n            </span>\r\n          </h2>\r\n          \r\n          <div v-if=\"loading\" class=\"flex justify-center py-4\">\r\n            <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"></div>\r\n          </div>\r\n          \r\n          <div v-else-if=\"friends.length === 0\" class=\"text-gray-500 dark:text-gray-400 text-center py-4\">\r\n            No friends yet. Start by adding some!\r\n          </div>\r\n          \r\n          <ul v-else class=\"space-y-3\">\r\n            <li v-for=\"friend in friends\" :key=\"friend._id\" \r\n                class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between p-3 bg-white/50 dark:bg-gray-800/50 rounded-lg hover:bg-white/80 dark:hover:bg-gray-700/80 transition-colors cursor-pointer\"\r\n                @click=\"openChat(friend._id)\">\r\n              <div class=\"flex items-center\">\r\n                <div class=\"relative\">\r\n                  <img :src=\"getProfilePictureUrl(friend)\" alt=\"Profile\" \r\n                       class=\"w-10 h-10 rounded-full object-cover mr-3\">\r\n                  <span class=\"absolute bottom-0 right-2 w-3 h-3 rounded-full\"\r\n                        :class=\"{\r\n                          'bg-green-500': onlineFriends.get(friend._id) === 'online',\r\n                          'bg-yellow-500': onlineFriends.get(friend._id) === 'away',\r\n                          'bg-gray-500': !onlineFriends.get(friend._id) || onlineFriends.get(friend._id) === 'offline'\r\n                        }\">\r\n                  </span>\r\n                </div>\r\n                <div>\r\n                  <div class=\"font-medium\">{{ friend.username }}</div>\r\n                  <div class=\"text-xs text-gray-500 dark:text-gray-400\">\r\n                    {{ onlineFriends.get(friend._id) === 'online' ? 'Online' : \r\n                       onlineFriends.get(friend._id) === 'away' ? 'Away' : \r\n                       'Offline' }}\r\n                  </div>\r\n                </div>\r\n              </div>\r\n              <div class=\"flex space-x-2 mt-2 sm:mt-0 ml-auto\">\r\n                <button @click.stop=\"openChat(friend._id)\" \r\n                        class=\"px-3 py-1 bg-primary-600 hover:bg-primary-700 text-white rounded-md text-sm transition-colors\">\r\n                  Chat\r\n                </button>\r\n                <button @click.stop=\"removeFriend(friend._id)\" \r\n                        class=\"px-3 py-1 bg-gray-200 hover:bg-gray-300 dark:bg-gray-700 dark:hover:bg-gray-600 text-gray-800 dark:text-white rounded-md text-sm transition-colors\">\r\n                  Remove\r\n                </button>\r\n              </div>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n      \r\n      <!-- Right content - Search and Add Friends -->\r\n      <div class=\"w-full md:w-2/3\">\r\n        <div class=\"bg-glass-light dark:bg-glass-dark backdrop-blur-md rounded-xl p-6 shadow-glass\">\r\n          <h2 class=\"text-xl font-bold text-gray-800 dark:text-white mb-4\">Find Friends</h2>\r\n          \r\n          <div class=\"mb-6\">\r\n            <div class=\"relative\">\r\n              <input \r\n                v-model=\"searchQuery\" \r\n                type=\"text\" \r\n                placeholder=\"Search by username or email\" \r\n                class=\"w-full px-4 py-2 bg-white/70 dark:bg-gray-800/70 border border-gray-300 dark:border-gray-700 rounded-lg focus:outline-none focus:ring-2 focus:ring-primary-600 dark:focus:ring-primary-500\"\r\n                @keyup.enter=\"searchUsers\"\r\n              >\r\n              <button \r\n                @click=\"searchUsers\" \r\n                class=\"absolute right-2 top-1/2 transform -translate-y-1/2 px-3 py-1 bg-primary-600 hover:bg-primary-700 text-white rounded-md text-sm transition-colors\"\r\n              >\r\n                Search\r\n              </button>\r\n            </div>\r\n          </div>\r\n          \r\n          <div v-if=\"searchLoading\" class=\"flex justify-center py-4\">\r\n            <div class=\"animate-spin rounded-full h-8 w-8 border-b-2 border-primary-600\"></div>\r\n          </div>\r\n          \r\n          <div v-else-if=\"searchResults.length === 0 && hasSearched\" class=\"text-gray-500 dark:text-gray-400 text-center py-4\">\r\n            No users found matching your search\r\n          </div>\r\n          \r\n          <ul v-else-if=\"searchResults.length > 0\" class=\"space-y-3\">\r\n            <li v-for=\"user in searchResults\" :key=\"user._id\" \r\n                class=\"flex flex-col sm:flex-row sm:items-center sm:justify-between p-4 bg-white/50 dark:bg-gray-800/50 rounded-lg\">\r\n              <div class=\"flex items-center\">\r\n                <img :src=\"getProfilePictureUrl(user)\" alt=\"Profile\" \r\n                     class=\"w-10 h-10 rounded-full object-cover mr-3\">\r\n                <span class=\"font-medium\">{{ user.username }}</span>\r\n              </div>\r\n              <button \r\n                @click=\"sendFriendRequest(user._id)\" \r\n                class=\"px-3 py-1 bg-primary-600 hover:bg-primary-700 text-white rounded-md text-sm transition-colors mt-2 sm:mt-0\"\r\n                :disabled=\"isFriend(user._id) || hasPendingRequest(user._id)\"\r\n                :class=\"{ 'opacity-50 cursor-not-allowed': isFriend(user._id) || hasPendingRequest(user._id) }\"\r\n              >\r\n                {{ isFriend(user._id) ? 'Already Friends' : \r\n                   hasPendingRequest(user._id) ? 'Request Pending' : 'Add Friend' }}\r\n              </button>\r\n            </li>\r\n          </ul>\r\n        </div>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</template>\r\n\r\n<script setup>\r\nimport { ref, onMounted, computed } from 'vue';\r\nimport { useApi } from '~/composables/useApi';\r\nimport { useSocket } from '~/composables/useSocket';\r\nimport { useRouter } from 'vue-router';\r\nimport { useToast } from 'vue-toastification';\r\n\r\nconst router = useRouter();\r\nconst toast = useToast();\r\n\r\nconst { \r\n  loading: apiLoading, \r\n  error: apiError,\r\n  getFriendsList,\r\n  getFriendRequests,\r\n  searchUsers: apiSearchUsers,\r\n  respondToFriendRequest: apiRespondToFriendRequest,\r\n  removeFriend: apiRemoveFriend,\r\n  getProfilePictureUrl\r\n} = useApi();\r\n\r\nconst {\r\n  onlineFriends,\r\n  sendFriendRequest: socketSendFriendRequest,\r\n  respondToFriendRequest: socketRespondToFriendRequest\r\n} = useSocket();\r\n\r\n// State\r\nconst friends = ref([]);\r\nconst friendRequests = ref({ received: [], sent: [] });\r\nconst searchQuery = ref('');\r\nconst searchResults = ref([]);\r\nconst searchLoading = ref(false);\r\nconst hasSearched = ref(false);\r\nconst loading = computed(() => apiLoading.value);\r\n\r\n// Load friends and friend requests\r\nonMounted(async () => {\r\n  await loadFriends();\r\n  await loadFriendRequests();\r\n});\r\n\r\nasync function loadFriends() {\r\n  try {\r\n    friends.value = await getFriendsList();\r\n  } catch (err) {\r\n    toast.error('Failed to load friends');\r\n    console.error(err);\r\n  }\r\n}\r\n\r\nasync function loadFriendRequests() {\r\n  try {\r\n    friendRequests.value = await getFriendRequests();\r\n  } catch (err) {\r\n    toast.error('Failed to load friend requests');\r\n    console.error(err);\r\n  }\r\n}\r\n\r\n// Search for users\r\nasync function searchUsers() {\r\n  if (!searchQuery.value.trim()) return;\r\n  \r\n  searchLoading.value = true;\r\n  hasSearched.value = true;\r\n  \r\n  try {\r\n    searchResults.value = await apiSearchUsers(searchQuery.value);\r\n  } catch (err) {\r\n    toast.error('Failed to search users');\r\n    console.error(err);\r\n  } finally {\r\n    searchLoading.value = false;\r\n  }\r\n}\r\n\r\n// Send friend request\r\nasync function sendFriendRequest(userId) {\r\n  try {\r\n    // Send via socket for real-time notification\r\n    socketSendFriendRequest(userId);\r\n    \r\n    // Also send via API as fallback\r\n    await apiSearchUsers(userId);\r\n    \r\n    toast.success('Friend request sent');\r\n    \r\n    // Refresh friend requests\r\n    await loadFriendRequests();\r\n  } catch (err) {\r\n    toast.error('Failed to send friend request');\r\n    console.error(err);\r\n  }\r\n}\r\n\r\n// Accept friend request\r\nasync function acceptFriendRequest(requestId) {\r\n  try {\r\n    // Accept via socket for real-time notification\r\n    socketRespondToFriendRequest(requestId, true);\r\n    \r\n    // Also accept via API as fallback\r\n    await apiRespondToFriendRequest(requestId, true);\r\n    \r\n    toast.success('Friend request accepted');\r\n    \r\n    // Refresh friends and friend requests\r\n    await loadFriends();\r\n    await loadFriendRequests();\r\n  } catch (err) {\r\n    toast.error('Failed to accept friend request');\r\n    console.error(err);\r\n  }\r\n}\r\n\r\n// Reject friend request\r\nasync function rejectFriendRequest(requestId) {\r\n  try {\r\n    // Reject via socket for real-time notification\r\n    socketRespondToFriendRequest(requestId, false);\r\n    \r\n    // Also reject via API as fallback\r\n    await apiRespondToFriendRequest(requestId, false);\r\n    \r\n    toast.success('Friend request rejected');\r\n    \r\n    // Refresh friend requests\r\n    await loadFriendRequests();\r\n  } catch (err) {\r\n    toast.error('Failed to reject friend request');\r\n    console.error(err);\r\n  }\r\n}\r\n\r\n// Remove friend\r\nasync function removeFriend(friendId) {\r\n  try {\r\n    await apiRemoveFriend(friendId);\r\n    \r\n    toast.success('Friend removed');\r\n    \r\n    // Refresh friends\r\n    await loadFriends();\r\n  } catch (err) {\r\n    toast.error('Failed to remove friend');\r\n    console.error(err);\r\n  }\r\n}\r\n\r\n// Open chat with friend\r\nfunction openChat(friendId) {\r\n  router.push(`/chat/${friendId}`);\r\n}\r\n\r\n// Check if user is already a friend\r\nfunction isFriend(userId) {\r\n  return friends.value.some(friend => friend._id === userId);\r\n}\r\n\r\n// Check if there's a pending friend request\r\nfunction hasPendingRequest(userId) {\r\n  return friendRequests.value.sent.some(request => request.receiver._id === userId) ||\r\n         friendRequests.value.received.some(request => request.sender._id === userId);\r\n}\r\n</script>"],"names":["_ssrRenderAttrs","_mergeProps","_ssrRenderAttr","_unref","_ssrInterpolate","_ssrRenderList"],"mappings":"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"}